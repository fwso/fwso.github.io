<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Parse HTML with PHP DOM</title>
  <meta name="description" content="With PHP DOM extension, parsing HTML data is straightforward just as parsing DOM in JavaScript. This post will demonstrate how to use DOMDocument and DOMXPat...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="http://tangobean.com/code/parse-html-with-php-dom/">
  <link rel="alternate" type="application/rss+xml" title="TangoBean" href="http://tangobean.com/feed.xml" />
</head>


  <body>

    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/">TangoBean</a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>

      <div class="trigger">
        
          
          <a class="page-link" href="/about/">About</a>
          
        
          
        
          
        
          
        
      </div>
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="post">

  <header class="post-header">
    <h1 class="post-title">Parse HTML with PHP DOM</h1>
    <p class="post-meta">Mar 12, 2013 • James Tang</p>
  </header>

  <article class="post-content">
    <p>With PHP DOM extension, parsing HTML data is straightforward just as parsing DOM in JavaScript. This post will demonstrate how to use DOMDocument and DOMXPath to extract data in which we are interested from general HTML file, but not strictly structured as XML.</p>

<p>Sample file looks like this:</p>

<pre class="brush:html;collapse: true">&lt;!DOCTYPE html&gt;
&lt;html&gt;
    &lt;head&gt;
        &lt;title&gt;王小五 - Profile&lt;/title&gt;
        &lt;meta charset="utf-8" /&gt;
        &lt;link href="/css/profile.css" rel="stylesheet" type="text/css"/&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;div id="wrapper"&gt;
            &lt;div id="header"&gt;
                &lt;h1&gt;王小五&lt;/h1&gt;
            &lt;/div&gt;
            &lt;div id="content"&gt;
                &lt;div id="profile-box"&gt;
                    &lt;div id="profile-img"&gt;
                        &lt;img id="profile-img" src="/profile_img.php?uid=32153" alt="" /&gt;
                    &lt;/div&gt;
                    &lt;ul class="ulist"&gt;
                        &lt;li&gt;
                            &lt;span class="field-name"&gt;Age:&lt;/span&gt; 
                            &lt;span class="field-value"&gt;31&lt;/span&gt;
                        &lt;/li&gt;
                        &lt;li&gt;
                            &lt;span class="field-name"&gt;Gender:&lt;/span&gt; 
                            &lt;span class="field-value"&gt;Female&lt;/span&gt;
                        &lt;/li&gt;
                        &lt;li&gt;
                            &lt;span class="field-name"&gt;Location:&lt;/span&gt; 
                            &lt;span class="field-value"&gt;Guangzhou, China&lt;/span&gt;
                        &lt;/li&gt;
                    &lt;/ul&gt;
                &lt;/div&gt;
            &lt;/div&gt;
            &lt;div id="footer"&gt;
                &lt;div class="x13"&gt;&copy; 2012 cctv.&lt;/div&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/body&gt;
&lt;/html&gt;
</pre>

<h2 id="load-html">1. Load HTML</h2>

<p>The simplest code looks like this:</p>

<pre class="brush:php">$html = file_get_contents('data.html');
$dom = new DOMDocument();
$dom-&gt;loadHTML($html);
$xpath = new DOMXPath($dom);
</pre>

<p>Notice that there are two elements with id=”profile-img” in the HTML, it’s not a “valid” HTML page, so when you try to run the code, you will encounter following PHP warning:</p>

<pre class="brush:plain">PHP Warning:  DOMDocument::loadHTML(): ID profile-img already defined in Entity, line: 16 in /home/james/projects/mixedlab/linux/php/xml/dom/demo/demo.php on line 6
</pre>

<p>Most of the times we’d like to ignore such warnings for it’s no likely for us to change the source html file which may generated by other PHP script written by a negligent programmer. Fortunately, this problem can be solved with just a little additional work:</p>

<pre class="brush:php">libxml_use_internal_errors(true);

$html = file_get_contents('data.html');
$dom = new DOMDocument();
$dom-&gt;loadHTML($html);
$xpath = new DOMXPath($dom);

libxml_clear_errors();
</pre>

<p>Set libxml_use_internal_errors to true to suppress the warning, but still you can catch the errors if you want to do something beside just ignore it.</p>

<p>Another problem we should solve is the file encoding. The demo HTML data was encoded in UTF-8, as the meta header shows, but DOMDocument cannot recognize it. DOMDocument can only accept http-equiv meta, so we have to do some preprocess on the HTML:</p>

<pre class="brush:php">$html = str_replace(
    '

<meta charset="utf-8" />
', 
    '

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
', 
    $html
);
</pre>

<h2 id="extract-data">2. Extract Data</h2>

<p>Although DOMDocument provides many methods for manipulating elements, such as DOMDocument::getElementsByClassName(), but I think it’s less useful and more complicated than using XPath.</p>

<p>XPath::query(string $expression [, DOMNode $contextnode [, bool $registerNodeNS = true ]]) always return a DOMNodeList object if the $expression is well formed and $contextnode is valid or NULL(not set).</p>

<p>Extract user name from header(h1):</p>

<pre class="brush:php">$nodes = $xpath-&gt;query('//*[@id="header"]/h1');
$name = $nodes-&gt;item(0)-&gt;nodeValue;
echo "Name: " . $name . "\n";
</pre>

<p>In most cases, the HTML structure is more complicated than the demo, and $contextnode will help us focus on the restricted section and keep the xpath query concise.</p>

<p>Extract sub-node by specifying the context node(for demonstration only in this case):</p>

<pre class="brush:php">$nodes = $xpath-&gt;query('//div[@id="header"]');
$headerNode = $nodes-&gt;item(0);
$nodes = $xpath-&gt;query('h1', $headerNode);
$name = $nodes-&gt;item(0)-&gt;nodeValue;
echo "Name: " . $name . "\n";
</pre>

<p>Extract user properties:</p>

<pre class="brush:php">$nodes = $xpath-&gt;query('//*[@id="profile-box"]/ul/li');
foreach ($nodes as $node) {
    $childNodes = $xpath-&gt;query('span', $node);
    $key = $childNodes-&gt;item(0)-&gt;nodeValue;
    $value = $childNodes-&gt;item(1)-&gt;nodeValue;
    echo $key . ' ' . $value . "\n";
}
</pre>

<h2 id="innerhtml-function">3. innerHTML function</h2>

<p>Here provides a useful function for extracting the inner HTML for one node:</p>

<pre class="brush:php">function innerHTML($node)
{
    $meta = '

<meta http-equiv="content-type" content="text/html;charset=utf-8" />
';
    $dom = new DOMDocument();
    $dom-&gt;loadHTML($meta);
    $dom-&gt;appendChild($dom-&gt;importNode($node, true));
    $html = preg_replace(
        '#^.*&lt;/html&gt;&lt;' . $node-&gt;nodeName . '[^&gt;]*&gt;(.*)&lt;/' . $node-&gt;nodeName . '&gt;.*$#s', 
        '\1', $dom-&gt;saveHTML());
    return $html;
}
</pre>

<h2 id="reference">4. Reference</h2>

<p>PHP Dom Manual: <a href="http://php.net/manual/en/book.dom.php">http://php.net/manual/en/book.dom.php</a></p>

<p>Full Demo for this Post: <a href="https://github.com/fwso/mixedlab/tree/master/linux/php/xml/dom/demo">https://github.com/fwso/mixedlab/tree/master/linux/php/xml/dom/demo</a></p>

  </article>

</div>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <h2 class="footer-heading">TangoBean</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col  footer-col-1">
        <ul class="contact-list">
          <li>TangoBean</li>
          <li><a href="mailto:"></a></li>
        </ul>
      </div>

      <div class="footer-col  footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/fwso">
              <span class="icon  icon--github">
                <svg viewBox="0 0 16 16">
                  <path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
                </svg>
              </span>

              <span class="username">fwso</span>
            </a>
          </li>
          

          
          <li>
            <a href="https://twitter.com/fwso">
              <span class="icon  icon--twitter">
                <svg viewBox="0 0 16 16">
                  <path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809
                  c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/>
                </svg>
              </span>

              <span class="username">fwso</span>
            </a>
          </li>
          
        </ul>
      </div>

      <div class="footer-col  footer-col-3">
        <p class="text">Think In Practice</p>
      </div>
    </div>

  </div>

</footer>


  </body>

</html>
